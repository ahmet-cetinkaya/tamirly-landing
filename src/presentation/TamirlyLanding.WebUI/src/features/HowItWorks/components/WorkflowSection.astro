---
import AnimatedSection from "@packages/acore-astro/src/components/AnimatedSection.astro";
import { getImage } from "astro:assets";
import WorkflowStep from "./WorkflowStep";
import { i18nInstance } from "@tamirly-landing-webui/shared/i18n/instance";
import { TranslationKeys } from "@tamirly-landing-webui/shared/i18n/enums/TranslationKeys";
import type { Locales } from "@tamirly-landing-webui/shared/i18n/enums/Locales";
import { Locales as LocalesEnum } from "@tamirly-landing-webui/shared/i18n/enums/Locales";

// English Screenshots
import step1EnDark from "@tamirly-landing-webui/shared/assets/app-screenshots/en-US/dark/2.png";
import step1EnLight from "@tamirly-landing-webui/shared/assets/app-screenshots/en-US/light/2.png";
import step2EnDark from "@tamirly-landing-webui/shared/assets/app-screenshots/en-US/dark/3.png";
import step2EnLight from "@tamirly-landing-webui/shared/assets/app-screenshots/en-US/light/3.png";
import step3EnDark from "@tamirly-landing-webui/shared/assets/app-screenshots/en-US/dark/5.png";
import step3EnLight from "@tamirly-landing-webui/shared/assets/app-screenshots/en-US/light/5.png";

// Turkish Screenshots
import step1TrDark from "@tamirly-landing-webui/shared/assets/app-screenshots/tr-TR/dark/2.png";
import step1TrLight from "@tamirly-landing-webui/shared/assets/app-screenshots/tr-TR/light/2.png";
import step2TrDark from "@tamirly-landing-webui/shared/assets/app-screenshots/tr-TR/dark/3.png";
import step2TrLight from "@tamirly-landing-webui/shared/assets/app-screenshots/tr-TR/light/3.png";
import step3TrDark from "@tamirly-landing-webui/shared/assets/app-screenshots/tr-TR/dark/5.png";
import step3TrLight from "@tamirly-landing-webui/shared/assets/app-screenshots/tr-TR/light/5.png";

interface Props {
  locale: Locales;
}

const { locale } = Astro.props;
const t = (key: TranslationKeys) => i18nInstance.translate(locale, key);

const isTr = locale === LocalesEnum.TR;
const step1ImgDarkSrc = isTr ? step1TrDark : step1EnDark;
const step1ImgLightSrc = isTr ? step1TrLight : step1EnLight;

const step2ImgDarkSrc = isTr ? step2TrDark : step2EnDark;
const step2ImgLightSrc = isTr ? step2TrLight : step2EnLight;

const step3ImgDarkSrc = isTr ? step3TrDark : step3EnDark;
const step3ImgLightSrc = isTr ? step3TrLight : step3EnLight;

const [step1ImgDark, step1ImgLight, step2ImgDark, step2ImgLight, step3ImgDark, step3ImgLight] = await Promise.all([
  getImage({ src: step1ImgDarkSrc, format: "webp", width: 200 }),
  getImage({ src: step1ImgLightSrc, format: "webp", width: 200 }),
  getImage({ src: step2ImgDarkSrc, format: "webp", width: 200 }),
  getImage({ src: step2ImgLightSrc, format: "webp", width: 200 }),
  getImage({ src: step3ImgDarkSrc, format: "webp", width: 200 }),
  getImage({ src: step3ImgLightSrc, format: "webp", width: 200 }),
]).then((images) => images.map((img) => img.src));
---

<section class="py-24 bg-background border-t border-border-color" id="how-it-works">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <AnimatedSection animation="fade-up">
        <h2 class="text-3xl font-bold tracking-tight text-text-main sm:text-4xl mb-4">
          {t(TranslationKeys.WORKFLOW_TITLE)}
        </h2>
        <p class="text-lg text-text-muted">
          {t(TranslationKeys.WORKFLOW_DESCRIPTION)}
        </p>
      </AnimatedSection>
    </div>

    <div class="relative">
      <div class="hidden lg:block absolute top-10 left-0 w-full h-0.5 bg-border-color z-0"></div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 relative z-10">
        <AnimatedSection animation="fade-up" delay={0}>
          <WorkflowStep
            stepNumber="01"
            title={t(TranslationKeys.WORKFLOW_STEP1_TITLE)}
            description={t(TranslationKeys.WORKFLOW_STEP1_DESC)}
            variant="select-appliance"
            imageSrcDark={step1ImgDark}
            imageSrcLight={step1ImgLight}
          />
        </AnimatedSection>

        <AnimatedSection animation="fade-up" delay={200}>
          <WorkflowStep
            stepNumber="02"
            title={t(TranslationKeys.WORKFLOW_STEP2_TITLE)}
            description={t(TranslationKeys.WORKFLOW_STEP2_DESC)}
            variant="enter-code"
            imageSrcDark={step2ImgDark}
            imageSrcLight={step2ImgLight}
          />
        </AnimatedSection>

        <AnimatedSection animation="fade-up" delay={400}>
          <WorkflowStep
            stepNumber="03"
            title={t(TranslationKeys.WORKFLOW_STEP3_TITLE)}
            description={t(TranslationKeys.WORKFLOW_STEP3_DESC)}
            variant="fix-it"
            imageSrcDark={step3ImgDark}
            imageSrcLight={step3ImgLight}
          />
        </AnimatedSection>
      </div>
    </div>
  </div>
</section>
