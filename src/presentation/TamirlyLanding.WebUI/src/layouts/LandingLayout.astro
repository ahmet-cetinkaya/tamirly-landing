---
import Metadata, { type StructuredData } from "@packages/acore-astro/src/components/Metadata.astro";
import { ClientRouter } from "astro:transitions";
import Navbar from "../features/Navigation/components/Navbar.astro";
import Footer from "../features/Footer/components/Footer.astro";
import "../styles/global.css";

import type { Locales } from "../shared/i18n/enums/Locales";
import { Locales as LocalesEnum } from "../shared/i18n/enums/Locales";
import Analytics from "../shared/components/Analytics.astro";

interface Props {
  title?: string;
  description?: string;
  locale?: Locales;
  structuredData?: StructuredData;
}

const {
  title = "Tamirly: Repair Guide",
  description = "Find appliance error codes & solutions. Offline repair guide.",
  locale = LocalesEnum.EN,
  structuredData,
} = Astro.props;
---

<html lang={locale}>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <!--
      Note: Astro bundles fonts with content hashes. After first build,
      add specific preloads like: <link rel="preload" href="/_astro/manrope-latin-400-normal.xxx.woff2" as="font" type="font/woff2" crossorigin />
      Fonts use @fontsource with font-display: swap for non-blocking loading.
    -->
    <script is:inline>
      function applyTheme() {
        const theme = localStorage.getItem("theme");
        const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

        if (theme === "dark" || (!theme && systemDark)) {
          // Applying dark (initial)
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }

      function handleSwap(event) {
        const theme = localStorage.getItem("theme");
        const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

        if (theme === "dark" || (!theme && systemDark)) {
          // Applying dark (swap)
          event.newDocument.documentElement.classList.add("dark");
        } else {
          event.newDocument.documentElement.classList.remove("dark");
        }
      }

      applyTheme();
      document.addEventListener("astro:before-swap", handleSwap);
    </script>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://analytics.ahmetcetinkaya.me" />
    <link rel="dns-prefetch" href="https://analytics.ahmetcetinkaya.me" />
    <ClientRouter />
    <Analytics />
    <Metadata
      title={title}
      description={description}
      site="https://tamirly.ahmetcetinkaya.me"
      structuredData={structuredData}
    />
  </head>
  <body
    class="bg-background-dark font-sans text-text-main transition-colors duration-300 antialiased selection:bg-primary selection:text-white"
  >
    <Navbar locale={locale} />

    <main>
      <slot />
    </main>

    <Footer locale={locale} />
  </body>
</html>
